import React, { useCallback } from 'react';
import { Price } from '../../types/PriceScheme.types';
import './SeatPriceWidget.scss';

interface SeatPriceWidgetProps {
  selectedSeats: string[];
  prices: Price[];
  onApplyPrice: (priceId: string) => void;
  onRemovePrice: () => void;
  onClose: () => void;
}

export const SeatPriceWidget: React.FC<SeatPriceWidgetProps> = ({
  selectedSeats,
  prices,
  onApplyPrice,
  onRemovePrice,
  onClose
}) => {
  // Функция для получения цвета цены (такая же как в канвасе)
  const getPriceColor = useCallback((price: number): string => {
    const colors = [
      '#2ECC71', // Изумрудно-зеленый (0-100)
      '#3498DB', // Синий (100-200)
      '#9B59B6', // Фиолетовый (200-300)
      '#E67E22', // Оранжевый (300-400)
      '#E74C3C', // Красный (400-500)
      '#F39C12', // Янтарный (500-600)
      '#1ABC9C', // Бирюзовый (600-700)
      '#34495E', // Темно-серый (700-800)
      '#E91E63', // Розовый (800-900)
      '#795548', // Коричневый (900-1000)
      '#607D8B', // Сине-серый (1000-1100)
      '#FF5722', // Глубокий оранжевый (1100-1200)
      '#3F51B5', // Индиго (1200-1300)
      '#009688', // Теал (1300-1400)
      '#FF9800', // Янтарный (1400-1500)
      '#4CAF50', // Зеленый (1500-1600)
      '#2196F3', // Синий (1600-1700)
      '#9C27B0', // Фиолетовый (1700-1800)
      '#FFC107', // Желтый (1800-1900)
      '#F44336', // Красный (1900-2000)
      '#8BC34A', // Светло-зеленый (2000-2100)
      '#00BCD4', // Циан (2100-2200)
      '#FFEB3B', // Ярко-желтый (2200-2300)
      '#FF9800', // Оранжевый (2300-2400)
      '#673AB7', // Глубокий фиолетовый (2400-2500)
      '#CDDC39', // Лайм (2500-2600)
      '#FF5722', // Глубокий оранжевый (2600-2700)
      '#795548', // Коричневый (2700-2800)
      '#607D8B', // Сине-серый (2800-2900)
      '#E91E63', // Розовый (2900-3000)
      '#3F51B5', // Индиго (3000-3100)
      '#009688', // Теал (3100-3200)
      '#FFC107', // Янтарный (3200-3300)
      '#4CAF50', // Зеленый (3300-3400)
      '#2196F3', // Синий (3400-3500)
      '#9C27B0', // Фиолетовый (3500-3600)
      '#FF9800', // Оранжевый (3600-3700)
      '#F44336', // Красный (3700-3800)
      '#2ECC71', // Изумрудно-зеленый (3800-3900)
      '#3498DB', // Синий (3900-4000)
      '#9B59B6', // Фиолетовый (4000-4100)
      '#E67E22', // Оранжевый (4100-4200)
      '#E74C3C', // Красный (4200-4300)
      '#F39C12', // Янтарный (4300-4400)
      '#1ABC9C', // Бирюзовый (4400-4500)
      '#34495E', // Темно-серый (4500-4600)
      '#E91E63', // Розовый (4600-4700)
      '#795548', // Коричневый (4700-4800)
      '#607D8B', // Сине-серый (4800-4900)
      '#FF5722', // Глубокий оранжевый (4900-5000)
      '#3F51B5', // Индиго (5000-5100)
      '#009688', // Теал (5100-5200)
      '#FF9800', // Янтарный (5200-5300)
      '#4CAF50', // Зеленый (5300-5400)
      '#2196F3', // Синий (5400-5500)
      '#9C27B0', // Фиолетовый (5500-5600)
      '#FFC107', // Желтый (5600-5700)
      '#F44336', // Красный (5700-5800)
      '#8BC34A', // Светло-зеленый (5800-5900)
      '#00BCD4', // Циан (5900-6000)
      '#FFEB3B', // Ярко-желтый (6000-6100)
      '#FF9800', // Оранжевый (6100-6200)
      '#673AB7', // Глубокий фиолетовый (6200-6300)
      '#CDDC39', // Лайм (6300-6400)
      '#FF5722', // Глубокий оранжевый (6400-6500)
      '#795548', // Коричневый (6500-6600)
      '#607D8B', // Сине-серый (6600-6700)
      '#E91E63', // Розовый (6700-6800)
      '#3F51B5', // Индиго (6800-6900)
      '#009688', // Теал (6900-7000)
      '#FFC107', // Янтарный (7000-7100)
      '#4CAF50', // Зеленый (7100-7200)
      '#2196F3', // Синий (7200-7300)
      '#9C27B0', // Фиолетовый (7300-7400)
      '#FF9800', // Оранжевый (7400-7500)
      '#F44336', // Красный (7500-7600)
      '#2ECC71', // Изумрудно-зеленый (7600-7700)
      '#3498DB', // Синий (7700-7800)
      '#9B59B6', // Фиолетовый (7800-7900)
      '#E67E22', // Оранжевый (7900-8000)
      '#E74C3C', // Красный (8000-8100)
      '#F39C12', // Янтарный (8100-8200)
      '#1ABC9C', // Бирюзовый (8200-8300)
      '#34495E', // Темно-серый (8300-8400)
      '#E91E63', // Розовый (8400-8500)
      '#795548', // Коричневый (8500-8600)
      '#607D8B', // Сине-серый (8600-8700)
      '#FF5722', // Глубокий оранжевый (8700-8800)
      '#3F51B5', // Индиго (8800-8900)
      '#009688', // Теал (8900-9000)
      '#FF9800', // Янтарный (9000-9100)
      '#4CAF50', // Зеленый (9100-9200)
      '#2196F3', // Синий (9200-9300)
      '#9C27B0', // Фиолетовый (9300-9400)
      '#FFC107', // Желтый (9400-9500)
      '#F44336', // Красный (9500-9600)
      '#8BC34A', // Светло-зеленый (9600-9700)
      '#00BCD4', // Циан (9700-9800)
      '#FFEB3B', // Ярко-желтый (9800-9900)
      '#FF9800', // Оранжевый (9900-10000)
      '#673AB7', // Глубокий фиолетовый (10000-10100)
      '#CDDC39', // Лайм (10100-10200)
      '#FF5722', // Глубокий оранжевый (10200-10300)
      '#795548', // Коричневый (10300-10400)
      '#607D8B', // Сине-серый (10400-10500)
      '#E91E63', // Розовый (10500-10600)
      '#3F51B5', // Индиго (10600-10700)
      '#009688', // Теал (10700-10800)
      '#FFC107', // Янтарный (10800-10900)
      '#4CAF50', // Зеленый (10900-11000)
      '#2196F3', // Синий (11000-11100)
      '#9C27B0', // Фиолетовый (11100-11200)
      '#FF9800', // Оранжевый (11200-11300)
      '#F44336', // Красный (11300-11400)
      '#2ECC71', // Изумрудно-зеленый (11400-11500)
      '#3498DB', // Синий (11500-11600)
      '#9B59B6', // Фиолетовый (11600-11700)
      '#E67E22', // Оранжевый (11700-11800)
      '#E74C3C', // Красный (11800-11900)
      '#F39C12', // Янтарный (11900-12000)
      '#1ABC9C', // Бирюзовый (12000-12100)
      '#34495E', // Темно-серый (12100-12200)
      '#E91E63', // Розовый (12200-12300)
      '#795548', // Коричневый (12300-12400)
      '#607D8B', // Сине-серый (12400-12500)
      '#FF5722', // Глубокий оранжевый (12500-12600)
      '#3F51B5', // Индиго (12600-12700)
      '#009688', // Теал (12700-12800)
      '#FF9800', // Янтарный (12800-12900)
      '#4CAF50', // Зеленый (12900-13000)
      '#2196F3', // Синий (13000-13100)
      '#9C27B0', // Фиолетовый (13100-13200)
      '#FFC107', // Желтый (13200-13300)
      '#F44336', // Красный (13300-13400)
      '#8BC34A', // Светло-зеленый (13400-13500)
      '#00BCD4', // Циан (13500-13600)
      '#FFEB3B', // Ярко-желтый (13600-13700)
      '#FF9800', // Оранжевый (13700-13800)
      '#673AB7', // Глубокий фиолетовый (13800-13900)
      '#CDDC39', // Лайм (13900-14000)
      '#FF5722', // Глубокий оранжевый (14000-14100)
      '#795548', // Коричневый (14100-14200)
      '#607D8B', // Сине-серый (14200-14300)
      '#E91E63', // Розовый (14300-14400)
      '#3F51B5', // Индиго (14400-14500)
      '#009688', // Теал (14500-14600)
      '#FFC107', // Янтарный (14600-14700)
      '#4CAF50', // Зеленый (14700-14800)
      '#2196F3', // Синий (14800-14900)
      '#9C27B0', // Фиолетовый (14900-15000)
    ];
    
    const index = Math.floor(price / 100);
    return colors[index % colors.length];
  }, []);

  if (selectedSeats.length === 0) {
    return null;
  }

  return (
    <div className="seat-price-widget">
      <div className="seat-price-widget__overlay" onClick={onClose} />
      <div className="seat-price-widget__content">
        <div className="seat-price-widget__header">
          <h4>Установить цену для мест</h4>
          <button onClick={onClose} className="seat-price-widget__close">×</button>
        </div>

        <div className="seat-price-widget__info">
          <p>Выбрано мест: <strong>{selectedSeats.length}</strong></p>
        </div>

        <div className="seat-price-widget__prices">
          {prices.length === 0 ? (
            <div className="seat-price-widget__empty">
              <p>Нет доступных цен. Сначала добавьте цены в список ниже.</p>
            </div>
          ) : (
            <>
              <h5>Выберите цену:</h5>
              <div className="price-options">
                {prices.map(price => (
                  <button
                    key={price.id}
                    onClick={() => onApplyPrice(price.id)}
                    className="price-option"
                  >
                    <div className="price-option__color" style={{ backgroundColor: getPriceColor(price.value) }} />
                    <div className="price-option__info">
                      <span className="price-option__name">{price.name}</span>
                      <span className="price-option__value">{price.value} {price.currency}</span>
                    </div>
                  </button>
                ))}
              </div>

              <div className="seat-price-widget__actions">
                <button
                  onClick={onRemovePrice}
                  className="btn btn--outline-danger btn--sm"
                >
                  Убрать цену
                </button>
              </div>
            </>
          )}
        </div>
      </div>
    </div>
  );
};
